{% extends 'paginas_base/base.html' %}
{% load crispy_forms_tags %}


{% block titulo %}Cargar Cuotas Jugador al Sistema{% endblock titulo %}
{% block contenido %}
    <div class="bg-success-subtle p-2 text-white">
        <div class="card-header">
            Crear Nueva Cuota Jugador
        </div>
        <div class="card-body">
            <h4 class="card-title">Jugador cuota</h4>
            <form action="" method="post"  enctype="multipart/form-data" autocomplete="off">
                {% csrf_token %}

                
              
                {{formulario.id|as_crispy_field}}
                {{formulario.nom|as_crispy_field}}    
                {{formulario.cuotaMes|as_crispy_field}}
                {{formulario.fechap|as_crispy_field}}
                {{formulario.importe|as_crispy_field}}
                         
                <br>
                  
            <br>
            <input name="btn-guardar" id="btn_guardar" class="btn btn-success border border-dark" type="submit"  value="Guardar">
            <a name="btnCancelar" id="btnCancelar" class="btn btn-primary border-dark" href="{% url 'listaCuota' %}" role="button">Cancelar</a>

            </form>           
            
            
        </div>
        <div class="card-footer text-muted">
            
        </div>
    </div>
   <script>
document.addEventListener('DOMContentLoaded', function() {
    // Ajusta los IDs según los que genera Django
    const idField = document.getElementById('id_id');
    const nomField = document.getElementById('id_nom');

    if (idField && nomField) {
        idField.addEventListener('change', function() {
            const selectedId = this.value;
            if (selectedId) {
                fetch(`/api/jugador/${selectedId}/nom/`)
                    .then(response => {
                        if (!response.ok) throw new Error('Error en la respuesta del servidor');
                        return response.json();
                    })
                    .then(data => {
                        nomField.value = data.nom || '';
                    })
                    .catch(() => {
                        nomField.value = '';
                        alert('No se pudo obtener el nombre del jugador. Verifica la conexión o el servidor.');
                    });
            } else {
                nomField.value = '';
            }
        });
    }
});
</script>
        
        </div>
        <div class="card-footer text-muted">
            
        </div>
    </div>
    
   
            
        </div>
        <div class="card-footer text-muted">
            
        </div>
    </div>
    
   

{% endblock contenido %}